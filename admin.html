<!DOCTYPE html>

<!--suppress ALL -->

<html>

<head>

    <meta charset="UTF-8">

    <title>Red Cross</title>


    <style type="text/css">

        #content {

            width: 50%;

            margin: 20px auto;

            border: 1px solid #cbcbcb;

        }

        a:link {
            text-decoration: none;
        }

        a:visited {
            text-decoration: none;
        }

        a:hover {
            text-decoration: none;
        }

        a:active {
            text-decoration: none;
        }
    </style>

    <style>

        * {

            box-sizing: border-box;

        }


        body {

            font-family: Arial, Helvetica, sans-serif;

        }


        /* Float four columns side by side */

        .columnn {

            width: 70%;

            padding: 10px 0px 10px 0px;

        }


        /* Remove extra left and right margins, due to padding */


        /* Clear floats after the columns */

        .roww:after {

            content: "";

            display: table;

            clear: both;

        }


        /* Responsive columns */

        @media screen and (max-width: 600px) {

            .columnn {

                width: 100%;

                display: block;

                margin-bottom: 20px;

            }

        }


        /* Style the counter cards */

        .cardd {

            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);

            padding: 48px;

            text-align: center;

            background-color: #f1f1f1;

        }


        .redCard {

            box-shadow: 0 4px 8px 0 rgba(178, 15, 23, 1);

            padding: 16px;

            text-align: center;

            background-color: red;

        }


        .greenCard {

            box-shadow: 0 4px 8px 0 rgba(0, 140, 33, 1);

            padding: 16px;

            text-align: center;

            background-color: green;

        }


        .reportDate {

            font-size: .67em;

            font-weight: normal;

        }


        .reportTitle {

            font-size: 88px;

        }


        #allUsers {

            left: 50%;

        }


        #grad {

            background-image: linear-gradient(to bottom, #ffffff, #e6e6e6);

        }


        .loader {
            border: 16px solid #f3f3f3;
            border-radius: 50%;
            border-top: 16px solid #3498db;
            width: 120px;
            height: 120px;
            -webkit-animation: spin 2s linear infinite; /* Safari */
            animation: spin 2s linear infinite;
        }

        /* Safari */
        @-webkit-keyframes spin {
            0% {
                -webkit-transform: rotate(0deg);
            }
            100% {
                -webkit-transform: rotate(360deg);
            }
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }


        .header {
            overflow: hidden;

            padding: 20px 10px;
        }

        .header a {
            float: left;
            color: black;
            text-align: center;
            padding: 12px;
            text-decoration: none;
            font-size: 18px;
            line-height: 25px;
            border-radius: 4px;
        }

        .header a.logo {
            text-decoration: none;
            font-size: 25px;
            font-weight: bold;
        }

        .header a:hover {
            text-decoration: none;
            background-color: #ddd;
            color: black;
        }

        .header a.active {
            text-decoration: none;
            background-color: dodgerblue;
            color: white;
        }

        .header-right {
            background-color: #f1f1f1;
            float: right;
        }

        @media screen and (max-width: 500px) {
            .header a {
                float: none;
                display: block;
                text-align: left;
            }

            .header-right {
                float: none;
            }
        }
        h1, h6 {
            font-family: "Playfair Display";
            letter-spacing: 5px;
        }
    </style>


</head>


<header>

    <!--    <div id="branding" >-->

    <!--		<a onclick="logout()" style = "cursor: pointer;text-decoration: none; color: blue; float: right; margin-right: 10px; margin-top: 5px; margin-bottom: 20px;">Logout</a>-->

    <!--        <a href="reports.html" style="text-decoration: none; color: blue; float: right; margin-right: 15px; margin-top: 5px;">Reports</a>-->

    <!--    </div>-->

    <link rel="stylesheet" href="footer.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css"
          integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.6.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.6.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.6.0/firebase.js"></script>
    <script src="https://cdn.firebase.com/libs/firebaseui/4.2.0/firebaseui.js"></script>
    <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/4.2.0/firebaseui.css"/>
    <script src="bundle.js"></script>
    <script src="app.js"></script>


    <script>

        var favoritemovie = localStorage.getItem("favoriteMovie");


        function checkPr() {

            var privChecker = -1;

            var isUserAdmin = localStorage.getItem("isUAdmin");
            
            if (isUserAdmin != "1") {
                //alert("Admin: " + isUserAdmin);
                logout();
                //window.location.href = 'index.html';

            }
        }

    </script>


</header>


<body id="grad" style="background-color:#ffffff;" onload="checkPr()">


<div class="header" style="text-decoration: none">

    <div class="header-right">
        <a href="reports.html">Reports</a>
        <a class="active" href="admin.html">Manage Users</a>
        <a onclick="logout()" style="cursor: pointer">Logout</a>
    </div>
    
</div>
    <img src='images/LogoRC.png' style='display: block; margin-left: auto; margin-right: auto; width:250px; height:250px;'/>

<div class="indeterminate"></div>
<div id="entries"></div>

<!--<img src='images/LogoRC.png' style='-->

<!--  margin-left: 42%; width:250px; height:250px;'/>-->

<h1 id="titlee" style="display: block; margin-top: 50px; margin-bottom: 20px; margin-left: auto; margin-right: auto; text-align: center"></h1>
<div id="allUsers" align="center"></div>
<div class="loader" id="PreLoaderBar" style="display: block; margin-left: auto; margin-right: auto; text-align: center"></div>


<script>

    var leadsRef = firebase.database().ref('user/LoR41MjKKz4V5V3UIdG');


    var currentID;

    var currentCenter;


    var favoritemovie = localStorage.getItem("favoriteMovie");

    if (favoritemovie != null) {


        firebase.database().ref('user/').child(favoritemovie).once('value', (snapshot) => {

            var data = snapshot.val();

            if (snapshot.exists()) {

                for (let key in data) {

                    currentCenter = data["Center"];

                }


                firebase.database().ref('Centers/' + currentCenter + '/members/').once('value', (snapshott) => {

                    var dataa = snapshott.val();

                    var bd = document.getElementById("allUsers");

                    if (snapshott.exists()) {


                        for (let key in dataa) {


                            firebase.database().ref('user/').orderByChild('Name').once('value', (snapshottt) => {
                                snapshottt.forEach(function (child) {
                                    
                                    
                                    if (child.key === key) {

                                        firebase.database().ref('user/').child(child.key).once('value', (snapshottt) => {

                                            var dataaa = snapshottt.val();

                                            var bd = document.getElementById("allUsers");

                                            if (snapshottt.exists()) {


                                                for (let key in dataaa) {

                                                    if (snapshottt.key != favoritemovie) {

                                                        var shiftDay = "";

                                                        if(dataaa["Shift"] === "1"){
                                                            shiftDay = "Monday";
                                                        }
                                                        else if(dataaa["Shift"] === "2"){
                                                            shiftDay = "Tuesday";
                                                        }
                                                        else if(dataaa["Shift"] === "3"){
                                                            shiftDay = "Wednesday";
                                                        }
                                                        else if(dataaa["Shift"] === "4"){
                                                            shiftDay = "Thursday";
                                                        }
                                                        else{
                                                            shiftDay = "Friday";
                                                        }

                                                        var createDivRow = document.createElement('div');
                                                        createDivRow.className = "roww";

                                                        var createDivColumn = document.createElement('div');
                                                        createDivColumn.className = "columnn";

                                                        var createDivCard = document.createElement('div');
                                                        createDivCard.className = "cardd";


                                                        var createInfo = document.createElement('div');


                                                        //<p>Shift Day: " + shiftDay + "</p>
                                                        createInfo.innerHTML = "<h3>" + dataaa["Name"] + "</h3><p style='color: blue;'><a href='tel:" + dataaa["Phone Number"] + "'style='text-decoration: none; color: blue;'>" + dataaa["Phone Number"] + "</a></p><p>Blood Type: " + dataaa["Blood Type"] + "</p><p>Position: " + dataaa["Position"] + "</p><p>Home Address: " + dataaa["Home Address"] + "</p><p>ICE: <span style='color: blue;'><a href='tel:"

                                                            + dataaa["ICE"] + "'style='text-decoration: none; color: blue;'>"+ dataaa["ICE"] + "</a></span></p>";


                                                        createInfo.innerHTML +=

                                                            "<button onClick=deleteUser(this.id,this.className) id =" + snapshottt.key + "  class = " + data['Center'] + "  style='color: #e6e6e6; border: none; text-decoration: none; padding: 0; float: right;'> <span class='btn btn-danger btn-xs'> Delete User </span> </button>"

                                                            +

                                                            "<button onClick=removeAdmin(this.id,this.className) id =" + snapshottt.key + " style='margin-right: 5px; color: #e6e6e6; border: none; text-decoration: none; padding: 0; float: right;'> <span class='btn btn-warning btn-xs'> Remove admin </span></button>"

                                                            +

                                                            "<button onClick=makeAdmin(this.id)   id =" + snapshottt.key + " style='margin-right: 5px; color: #e6e6e6; border: none; text-decoration: none; padding: 0; float: right;'> <span class='btn btn-primary btn-xs'> Make admin </span></button>";


                                                    }

                                                }

                                                document.getElementById("PreLoaderBar").style.display = "none";
                                                document.getElementById("titlee").innerHTML = "Users";
                                                bd.appendChild(createDivRow).appendChild(createDivColumn).appendChild(createDivCard).appendChild(createInfo);
                                            }
                                        })
                                    }
                                });
                            });
                        }
                    }
                })



            }
        })


    } else {


    }


</script>




<script>

    function removeAdmin(userID) {


        if (confirm('Are you sure you want to remove ADMIN from this user?')) {


            //if(isAdmin == true){

            firebase.database().ref('user/' + userID).update({

                Admin: 0

            });

            location.reload();


            //}


        } else {


        }


    }


</script>


<script>

    function makeAdmin(userID) {


        if (confirm('Are you sure you want to make this user an admin?')) {

            firebase.database().ref('user/' + userID).update({

                Admin: 1

            });

            location.reload();


        } else {


        }


    }

</script>


<script>

    function deleteUser(userID, centerLoc) {


        if (confirm('Are you sure you want to delete this user?')) {



            firebase.database().ref('user/').child(userID).once('value', (snapshottt) => {

                var dataaa = snapshottt.val();

                var bd = document.getElementById("allUsers");

                if (snapshottt.exists()) {
                    //alert(snapshottt.key);
                    firebase.database().ref('user/').child(userID).remove();
                }

            });




            firebase.database().ref('Centers/' + centerLoc + '/members/').child(userID).once('value', (snapshottt) => {

                var dataaa = snapshottt.val();


                if (snapshottt.exists()) {
                    //alert("HERE " + snapshottt.key);
                    firebase.database().ref('Centers/' + centerLoc + '/members/').child(userID).remove();
                }

            });







            firebase.database().ref('Centers/' + centerLoc + '/broadcast/').once('value', (snapshottt) => {

                var dataaa = snapshottt.val();

                if (snapshottt.exists()) {

                    for (let key in dataaa) {

                        firebase.database().ref('Centers/' + centerLoc + '/broadcast/').child(key).child(userID).once('value', (snapshottt) => {

                            var dataaa = snapshottt.val();
                            if (snapshottt.exists()) {
                                //alert(key + " " + snapshottt.key);
                                firebase.database().ref('Centers/'+centerLoc+'/broadcast/').child(key).child(userID).remove();
                            }
                        });
                    }
                }
            });




            firebase.database().ref('Centers/' + centerLoc + '/reports/').once('value', (snapshottt) => {

                var dataaa = snapshottt.val();

                if (snapshottt.exists()) {

                    for (let key in dataaa) {

                        firebase.database().ref('Centers/' + centerLoc + '/reports/').child(key).once('value', (snapshottt) => {

                            var dataaa = snapshottt.val();
                            if (snapshottt.exists()) {

                                for (let keyy in dataaa) {



                                    firebase.database().ref('Centers/' + centerLoc + '/reports/').child(key).child(keyy).once('value', (snapshottt) => {

                                        var dataaaf = snapshottt.val();

                                        if (snapshottt.exists()) {

                                            if (snapshottt.child("didntcome").child(userID).exists()) {
                                                firebase.database().ref('Centers/' + centerLoc + '/reports/').child(key).child(keyy).child("didntcome").child(userID).remove();
                                            }
                                            if (snapshottt.child("came").child(userID).exists()) {
                                                firebase.database().ref('Centers/' + centerLoc + '/reports/').child(key).child(keyy).child("came").child(userID).remove();
                                            }

                                        }
                                        location.reload();
                                    });


                                }

                            }
                        });
                    }
                }
            });
        }





        else {


        }


    }

</script>


<script>

    function logout() {

        
        firebase.auth().signOut()

            .then(function () {
    
                localStorage.clear();
                window.location.href = 'index.html';

                //location.reload();


                // Sign-out successful.

            })

            .catch(function (error) {

                alert("SIGN OUT ERROR");

                // An error happened

            });

    }


</script>


</body>


<footer class="footer-basic-centered" style="margin-top: 350px; background-color:#e6e6e6; bottom: 0; width: 100%">


    <p class="footer-company-motto" style="color: #000000">Lebanese Red Cross</p>


    <div class="container2" style="margin-top:10px;">


        <div class="b">


            <p style="color:#000000;font-family:Tahoma;text-align:left;font-size: 16px;">Per Humanitatem ad Pacem - With
                Humanity, Towards Peace</p>

            <br><br>

            <p style="color:#000000;font-family:Tahoma;text-align:left;font-size: 16px;"><a
                    href="mailto:ahmad_kassabieh@msn.com" style="text-decoration: none;color:#000000;">ahmad_kassabieh@msn.com</a><br>

                Lebanese Red Cross</p>


        </div>


        <div class="a">


            <img src='images/LogoRC.png' style="width:150px; height: 150px;"></img>

            <br>

            <a style="color:#000000;" onmouseover="style='text-decoration:none; color:#000000;'"
               onmouseout="style='text-decoration:none; color:#000000;'"
               href="https://www.facebook.com/ahmad.kassabieh.3"><i class="icon-facebook">&nbsp</i></a>


            <a style="color:#000000;" onmouseover="style='text-decoration:none; color:#000000;'"
               onmouseout="style='text-decoration:none; color:#000000;'"
               href="https://www.instagram.com/ahmadkassabieh/"><i class="fab fa-instagram">&nbsp</i></a>


            <a style="color:#000000;" onmouseover="style='text-decoration:none; color:#000000;'"
               onmouseout="style='text-decoration:none; color:#000000;'" href="https://github.com/"><i
                    class="icon-github"></i></a><br><br>

        </div>


    </div>


    <br><br>

    <p class="footer-company-name" style="color: black">Lebanese Red Cross &copy; 2019. All Rights Reserved.</p>


</footer>


</html>